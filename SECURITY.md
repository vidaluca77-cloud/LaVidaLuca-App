# Security Configuration Guide

## Overview

This document outlines security configurations and best practices for La Vida Luca App production deployment.

## Environment Security

### Secret Management

#### GitHub Secrets (Repository Level)
```bash
# Deployment Secrets
RENDER_DEPLOY_HOOK_IA         # Render deployment webhook URL
VERCEL_TOKEN                  # Vercel authentication token
VERCEL_ORG_ID                 # Vercel organization identifier
VERCEL_PROJECT_ID             # Vercel project identifier
```

#### Render Environment Variables (Manual Configuration Required)
```bash
# Authentication & Encryption
JWT_SECRET_KEY                # Auto-generated by Render (32+ chars)

# External APIs
OPENAI_API_KEY                # OpenAI API key for AI features

# Monitoring & Error Tracking
SENTRY_DSN                    # Sentry backend DSN for error tracking

# Email Configuration (Optional)
SMTP_HOST                     # SMTP server hostname
SMTP_USERNAME                 # SMTP authentication username
SMTP_PASSWORD                 # SMTP authentication password
```

#### Vercel Environment Variables (Manual Configuration Required)
```bash
# Monitoring
NEXT_PUBLIC_SENTRY_DSN        # Sentry frontend DSN
SENTRY_DSN                    # Sentry backend DSN (for build-time errors)

# Analytics (Optional)
NEXT_PUBLIC_GA_TRACKING_ID    # Google Analytics tracking ID
NEXT_PUBLIC_HOTJAR_ID         # Hotjar tracking ID
```

## Network Security

### CORS Configuration

**Production Origins (Backend)**
```python
CORS_ORIGINS = [
    "https://lavidaluca.fr",
    "https://www.lavidaluca.fr", 
    "https://lavidaluca.vercel.app"
]
```

**Security Headers (Frontend)**
```typescript
// Implemented in next.config.ts
{
  'X-Frame-Options': 'DENY',
  'X-Content-Type-Options': 'nosniff',
  'Referrer-Policy': 'strict-origin-when-cross-origin',
  'Permissions-Policy': 'camera=(), microphone=(), geolocation=()'
}
```

### Trusted Hosts

**Backend Trusted Hosts**
```python
TRUSTED_HOSTS = [
    "lavidaluca.fr",
    "*.lavidaluca.fr",
    "lavidaluca-backend.onrender.com"
]
```

## Authentication & Authorization

### JWT Configuration

**Security Settings**
```python
JWT_ALGORITHM = "HS256"                    # Secure algorithm
JWT_EXPIRATION_HOURS = 24                  # 24-hour token lifetime
JWT_SECRET_KEY = "auto-generated-secure"   # 256-bit secure key
```

**Best Practices**
- JWT secrets are auto-generated by Render (32+ characters)
- Tokens expire after 24 hours to limit exposure
- HS256 algorithm for secure signing
- No sensitive data stored in JWT payload

### Rate Limiting

**Production Limits**
```python
RATE_LIMIT_REQUESTS_PER_MINUTE = 100          # Authenticated users
RATE_LIMIT_REQUESTS_PER_MINUTE_ANONYMOUS = 20  # Anonymous users
```

**Protection Against**
- Brute force attacks
- API abuse
- DDoS mitigation
- Resource exhaustion

## Data Security

### Database Security

**Connection Security**
- SSL/TLS encryption for all database connections
- Connection pooling with secure parameters
- Automatic backups with encryption
- Network isolation via Render's private networking

**Configuration**
```python
DATABASE_POOL_SIZE = 10        # Controlled connection pool
DATABASE_MAX_OVERFLOW = 20     # Prevent connection exhaustion
```

### Data Validation

**Input Sanitization**
- Pydantic models for request validation
- SQL injection prevention via SQLAlchemy ORM
- XSS protection via output encoding
- CSRF protection for state-changing operations

## Infrastructure Security

### Render Security Features

**Automatic Security**
- TLS 1.3 encryption for all traffic
- Automatic security updates
- DDoS protection
- Web Application Firewall (WAF)

**Network Security**
- Private networking between services
- Automatic SSL certificate management
- IP-based access controls available

### Vercel Security Features

**Built-in Protection**
- Global CDN with DDoS protection
- Automatic HTTPS with perfect forward secrecy
- Edge runtime security
- Automatic security headers

## Monitoring & Incident Response

### Security Monitoring

**Error Tracking (Sentry)**
```bash
# Backend Configuration
SENTRY_DSN=https://...@sentry.io/...
SENTRY_ENVIRONMENT=production
SENTRY_RELEASE=1.0.0

# Frontend Configuration  
NEXT_PUBLIC_SENTRY_DSN=https://...@sentry.io/...
```

**Monitoring Capabilities**
- Real-time error tracking
- Performance monitoring
- Security issue alerts
- User session replay (if enabled)

### Health Monitoring

**Endpoints**
```bash
# Backend Health Check
GET https://lavidaluca-backend.onrender.com/health

# Database Health Check (included in /health)
# - Database connectivity
# - Connection pool status
# - Query performance metrics
```

### Incident Response

**Security Incident Process**
1. **Detection**: Automated alerts via Sentry/monitoring
2. **Assessment**: Review logs and metrics
3. **Response**: Immediate containment actions
4. **Recovery**: Service restoration and fixes
5. **Post-Incident**: Review and improve security

## Security Best Practices

### Development Security

**Code Security**
- Regular dependency updates
- Vulnerability scanning via GitHub Security
- Code review requirements for production
- Secret scanning enabled

**Deployment Security**
- Environment separation (dev/staging/prod)
- Minimal production access
- Audit logging for all changes
- Automated security testing in CI/CD

### Operational Security

**Access Control**
- Principle of least privilege
- Regular access review
- Multi-factor authentication required
- Secure secret rotation

**Monitoring**
- Continuous security monitoring
- Regular vulnerability assessments
- Log analysis and alerting
- Performance and availability tracking

## Compliance & Audit

### Security Audit Checklist

**Monthly Security Review**
- [ ] Review and rotate sensitive credentials
- [ ] Check for dependency vulnerabilities
- [ ] Review access logs and permissions
- [ ] Verify backup integrity
- [ ] Test incident response procedures

**Quarterly Security Assessment**
- [ ] Penetration testing (if applicable)
- [ ] Security configuration review
- [ ] Threat model update
- [ ] Security training review

### Documentation Maintenance

**Security Documentation**
- Keep security configurations up to date
- Document all security incidents
- Maintain access control documentation
- Regular review of security procedures

## Emergency Procedures

### Security Incident Response

**Immediate Actions**
1. Assess the scope and impact
2. Contain the incident (isolate affected systems)
3. Preserve evidence for investigation
4. Notify stakeholders as required
5. Begin recovery procedures

**Communication Plan**
- Internal notification procedures
- External communication if required
- Documentation requirements
- Post-incident reporting

### Disaster Recovery

**Backup Strategy**
- Automatic database backups (Render)
- Source code backup (GitHub)
- Configuration backup (documented)
- Deployment pipeline backup

**Recovery Procedures**
1. Assess damage and required recovery scope
2. Restore from known good backups
3. Verify system integrity
4. Test all functionality
5. Resume normal operations

## Contact Information

**Security Team**: [Insert security contact]
**Technical Support**: [Insert technical contact]
**Emergency Contact**: [Insert emergency contact]

---

**Last Updated**: [Current Date]
**Review Schedule**: Monthly
**Next Review**: [Next Review Date]